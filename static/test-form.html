<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Field Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .form-field {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 5px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, textarea, input[type="checkbox"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        .status {
            padding: 10px;
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
        }
    </style>
</head>
<body>
    <h1>Form Field Visibility Test</h1>

    <div id="status" class="status">
        Page loaded. Check console for logs.
    </div>

    <div class="form-field">
        <label for="method">HTTP Method</label>
        <select id="method">
            <option value="GET" selected>GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
        </select>
    </div>

    <div class="form-field" id="bodyField" style="display: none; border: 2px solid green;">
        <label for="body">Request Body (should show for POST/PUT/PATCH)</label>
        <textarea id="body" rows="4" placeholder='{"key": "value"}'></textarea>
    </div>

    <div class="form-field">
        <label>
            <input type="checkbox" id="enableHeaders">
            Enable Custom Headers
        </label>
    </div>

    <div id="headersConfig" style="display: none; border: 2px solid blue;">
        <div class="form-field">
            <label for="customHeaders">Custom Headers (should show when checkbox checked)</label>
            <textarea id="customHeaders" rows="3" placeholder='{"Content-Type": "application/json"}'></textarea>
        </div>
    </div>

    <script>
        console.log("=== Form Field Test Script Started ===");

        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = isError ? 'status error' : 'status';
        }

        function toggleHeadersConfig() {
            const enableHeaders = document.getElementById("enableHeaders");
            const headersConfig = document.getElementById("headersConfig");

            console.log("[toggleHeadersConfig] Called");
            console.log("  - enableHeaders element:", enableHeaders);
            console.log("  - enableHeaders.checked:", enableHeaders ? enableHeaders.checked : "N/A");
            console.log("  - headersConfig element:", headersConfig);

            if (!headersConfig) {
                const error = "ERROR: headersConfig element not found!";
                console.error(error);
                updateStatus(error, true);
                return;
            }

            if (!enableHeaders) {
                const error = "ERROR: enableHeaders element not found!";
                console.error(error);
                updateStatus(error, true);
                return;
            }

            const shouldShow = enableHeaders.checked;
            headersConfig.style.display = shouldShow ? "block" : "none";

            console.log("  - shouldShow:", shouldShow);
            console.log("  - Set display to:", headersConfig.style.display);

            updateStatus(`Headers config ${shouldShow ? 'shown' : 'hidden'}`);
        }

        function toggleBodyField() {
            const methodEl = document.getElementById("method");
            const bodyField = document.getElementById("bodyField");

            console.log("[toggleBodyField] Called");
            console.log("  - method element:", methodEl);
            console.log("  - method value:", methodEl ? methodEl.value : "N/A");
            console.log("  - bodyField element:", bodyField);

            if (!bodyField) {
                const error = "ERROR: bodyField element not found!";
                console.error(error);
                updateStatus(error, true);
                return;
            }

            if (!methodEl) {
                const error = "ERROR: method element not found!";
                console.error(error);
                updateStatus(error, true);
                return;
            }

            const method = methodEl.value;
            const methodsWithBody = ["POST", "PUT", "PATCH"];
            const shouldShow = methodsWithBody.includes(method);

            bodyField.style.display = shouldShow ? "block" : "none";

            console.log("  - method:", method);
            console.log("  - shouldShow:", shouldShow);
            console.log("  - Set display to:", bodyField.style.display);

            updateStatus(`Method: ${method}, Body field ${shouldShow ? 'shown' : 'hidden'}`);
        }

        // Test on DOMContentLoaded
        window.addEventListener("DOMContentLoaded", () => {
            console.log("[Init] DOMContentLoaded fired");

            // Set up event listeners
            const methodEl = document.getElementById("method");
            const enableHeadersEl = document.getElementById("enableHeaders");

            if (methodEl) {
                methodEl.addEventListener("change", toggleBodyField);
                console.log("[Init] Method change listener added");
            } else {
                console.error("[Init] method element not found!");
            }

            if (enableHeadersEl) {
                enableHeadersEl.addEventListener("change", toggleHeadersConfig);
                console.log("[Init] EnableHeaders change listener added");
            } else {
                console.error("[Init] enableHeaders element not found!");
            }

            // Initialize visibility
            console.log("[Init] Calling initial toggles...");
            toggleBodyField();
            toggleHeadersConfig();

            console.log("[Init] Complete");
            updateStatus("Initialization complete. Try changing the dropdown or checkbox!");
        });

        // Also test immediately
        console.log("Testing immediate execution (before DOMContentLoaded)...");
        setTimeout(() => {
            console.log("Testing with setTimeout...");
            toggleBodyField();
            toggleHeadersConfig();
        }, 100);
    </script>
</body>
</html>
